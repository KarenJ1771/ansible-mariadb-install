- name: Set mariadb root password
  mysql_user:
    name: root
    password: "{{ mariadb_root_password|mandatory }}"

- name: Setup root client's root password
  template:
    src: user-my.cnf
    dest: ~/.my.cnf
    mode: 0600

- name: Propagate mariadb root password to 127.0.0.1 and ::1
  mysql_user:
    name: root
    password: "{{ mariadb_root_password|mandatory }}"
    host: "{{ item }}"
  with_items: 
    - 127.0.0.1
    - ::1

- name: Disallow root login remotely
  command: >
    mysql -NBe "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1')"
  changed_when: False
